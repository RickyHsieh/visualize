<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Audio Reactive Visualizer</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');

        /* Basic reset */
        body {
            margin: 0;
            padding: 0;
            overflow: hidden; /* 防止捲動 */
            background-color: #000;
            font-family: Arial, sans-serif;
            color: #fff;
            /* 禁止手機上的雙擊縮放 */
            touch-action: none;
        }

        /* UI Overlay styles */
        #ui {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            pointer-events: none;
        }

        /* Liquid Glass Menu - Top Navigation */
        #controls {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap; /* 允許換行 */
            pointer-events: all;
            padding: 20px;
            z-index: 100;
            box-sizing: border-box; /* 確保 padding 不會撐破寬度 */

            /* Glass Effect */
            background: rgba(20, 20, 40, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
            background-image: linear-gradient(90deg, rgba(100, 150, 255, 0.08) 0%, rgba(150, 100, 255, 0.12) 25%, rgba(255, 100, 200, 0.08) 50%, rgba(100, 200, 255, 0.12) 75%, rgba(100, 150, 255, 0.08) 100%);
            background-size: 200% 100%;
            animation: liquidFlow 8s ease-in-out infinite;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.3), 0 0 80px rgba(100, 150, 255, 0.15), inset 0 -1px 0 rgba(255, 255, 255, 0.1);
        }

        @keyframes liquidFlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        button {
            position: relative;
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.25);
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.6);
            font-weight: 500;
            font-size: 14px;
            overflow: hidden;
            white-space: nowrap; /* 防止文字換行 */

            /* Liquid background */
            background-image: linear-gradient(135deg, rgba(100, 150, 255, 0.15) 0%, rgba(150, 100, 255, 0.15) 50%, rgba(255, 100, 200, 0.15) 100%);
            background-size: 200% 200%;
            animation: liquidButton 6s ease infinite;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.2), 0 0 30px rgba(100, 150, 255, 0.1);
        }

        @keyframes liquidButton {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        button:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(150, 200, 255, 0.7);
            transform: translateY(-2px);
        }

        button.active {
            background: linear-gradient(135deg, rgba(100, 150, 255, 0.25), rgba(150, 100, 255, 0.25));
            border-color: rgba(150, 200, 255, 0.9);
            box-shadow: 0 0 40px rgba(100, 150, 255, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.5);
        }

        #micBtn {
            background: linear-gradient(135deg, rgba(255, 100, 100, 0.2), rgba(200, 50, 50, 0.2));
            border-color: rgba(255, 150, 150, 0.6);
        }

        #micBtn.active {
            background: linear-gradient(135deg, rgba(100, 255, 150, 0.25), rgba(50, 200, 100, 0.25));
            border-color: rgba(150, 255, 200, 0.9);
        }

        /* Hint Text */
        #hint {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            pointer-events: none;
            text-align: center;
            opacity: 0.7;
            font-size: 14px;
            z-index: 10;
            width: 100%;
        }

        /* Pitch Display */
        /* --- 電腦版預設 (Desktop Default) --- */

        #pitchDisplay {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            pointer-events: none;
            text-align: center;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px 30px;
            border-radius: 10px;
            /* 關鍵修改：取消 min-width，改用 width fit-content */
            width: auto;
            max-width: 80%;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        #dataHud {
            position: absolute;
            top: 110px;
            left: 20px;
            /* 關鍵修改：使用 max-width 而不是 width */
            width: auto;
            max-width: 240px;
            padding: 14px 18px;
            background: rgba(0, 20, 0, 0.6);
            border: 1px solid rgba(0, 255, 128, 0.4);
            border-radius: 10px;
            font-family: 'Share Tech Mono', 'Courier New', monospace;
            font-size: 12px;
            color: #71ffb2;
            pointer-events: none;
            box-shadow: 0 0 18px rgba(0, 255, 128, 0.15);
            /* 讓內容不換行，保持整齊 */
            white-space: nowrap;
        }


        /* --- 手機版調整 (Mobile RWD) --- */

        @media (max-width: 768px) {
            /* 1. 音高顯示塊縮小 */
            #pitchDisplay {
                bottom: 120px; /* 往上移，避免擋到底部 */
                width: 80%;    /* 寬度佔螢幕 80% */
                padding: 10px;
                left: 50%;
                transform: translateX(-50%);
            }

            #pitchNote {
                font-size: 32px; /* 字體變小 */
            }

            #pitchFreq {
                font-size: 14px;
            }

            /* 2. 數據說明塊 (綠色那個) 縮小 */
            #dataHud {
                top: auto;      /* 取消頂部定位 */
                bottom: 10px;   /* 移到底部 */
                left: 50%;      /* 居中 */
                transform: translateX(-50%); /* 真正的居中校正 */

                width: 90%;     /* 寬度佔 90% */
                max-width: none; /* 取消限制 */

                display: flex;  /* 改用 Flex 讓內容並排，節省垂直空間 */
                flex-wrap: wrap;
                justify-content: space-between;
                gap: 5px;

                padding: 8px;
                font-size: 10px; /* 字體縮極小 */
                background: rgba(0, 20, 0, 0.85);
                z-index: 20;
            }

            /* 讓每一行數據在手機上不佔用整行，而是緊湊排列 */
            #dataHud .line {
                margin: 0 4px;
                display: inline-block;
            }

            /* 隱藏較不重要的描述文字以節省空間 */
            #dataHud .desc {
                display: none;
            }
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/addons/p5.sound.js"></script>
</head>
<body>
<div id="ui">
    <div id="controls">
        <button id="micBtn">Start Mic</button>
        <button data-scene="0" class="active">Scene 1: Cosmos</button>
        <button data-scene="1">Scene 2: Bass Geometry</button>
        <button data-scene="2">Scene 3: Heightmap</button>
        <button data-scene="3">Scene 4: Faraday Ripple</button>
        <button data-scene="4">Scene 5: Falling</button>
    </div>

    <div id="hint">Drag mouse to rotate, scroll wheel to zoom.</div>

    <div id="pitchDisplay" style="display: none;">
        <div id="pitchNote">Listening...</div>
        <div id="pitchFreq">-- Hz</div>
        <div id="pitchConfidence">
            <div>Confidence: <span id="pitchConfidenceValue">0%</span></div>
            <div id="pitchBar"><div id="pitchBarFill"></div></div>
        </div>
    </div>

    <div id="dataHud">
        <div class="line">AUDIO ENGINE: READY</div>
        <div class="line">FFT BINS: 1024</div>
        <div class="desc">System initialized. Waiting for input.</div>
    </div>
</div>

<script src="scenes/scene-static.js"></script>
<script src="scenes/scene-cosmos.js"></script>
<script src="scenes/scene-bass.js"></script>
<script src="scenes/scene-heightmap.js"></script>
<script src="scenes/scene-faraday.js"></script>
<script src="scenes/scene-falling.js"></script>

<script src="index.js"></script>

<script>
    if ('ontouchstart' in window || navigator.maxTouchPoints) {
        document.getElementById('hint').innerText = "Drag to rotate, Pinch to zoom";
    }
</script>
</body>
</html>